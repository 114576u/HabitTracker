{% extends 'base.html' %}
{% block content %}
  <section class="row mb">
    <button class="btn" onclick="shiftMonth(-1)">◀ Prev</button>
    <button class="btn" onclick="goToday()">Today</button>
    <button class="btn" onclick="shiftMonth(1)">Next ▶</button>
    <div class="spacer"></div>
    <div class="muted" id="monthLabel"></div>
  </section>

  <section class="calendar" id="calendar"></section>

  <section class="mb">
    <div class="row">
      <h2 class="subtitle">Habits</h2>
      <div class="spacer"></div>
      <div class="muted">Selected day: <span id="selectedDate"></span></div>
      <button class="btn" onclick="openAddModal()">+ New habit</button>
    </div>
    <div id="habits"></div>
  </section>

  <section class="mb">
    <div class="row">
      <h2 class="subtitle">Journal (movies, books, etc.)</h2>
      <div class="spacer"></div>
    </div>
    <div class="card">
      <div class="row wrap">
        <input id="entryText" type="text" placeholder="Title or notes (e.g., 'Dune: Part Two')">
        <input id="entryLink" type="text" placeholder="Link (Netflix/IMDb/Goodreads...)">
        <select id="entryCategory">
          <option value="">(category)</option>
          <option>movie</option>
          <option>series</option>
          <option>book</option>
          <option>other</option>
        </select>
        <label class="row"><input id="entryChecked" type="checkbox"> Done</label>
        <label>Rating</label>
        <select id="entryRating">
          <option value="">(none)</option>
          <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
        <input id="entryTags" type="text" placeholder="tags (comma separated)">
        <button class="btn primary" onclick="addEntry()">Add</button>
      </div>
      <div id="entries" class="mt"></div>
    </div>
  </section>

  <div class="modal-backdrop" id="addModal" onclick="closeAddModal()">
    <div class="modal" onclick="event.stopPropagation()">
      <h3>Add habit</h3>
      <label>Name</label>
      <input id="habitName" type="text" placeholder="e.g., Run, Meditate">
      <div class="row">
        <label><input type="radio" name="habitKind" value="checkbox" checked> Checkbox</label>
        <label><input type="radio" name="habitKind" value="metrics"> Metrics (time + distance)</label>
        <label><input type="radio" name="habitKind" value="numeric"> Numeric (value + unit)</label>
      </div>
      <div id="numericOpts" class="mt" style="display:none">
        <div class="row wrap">
          <input id="numUnit" type="text" placeholder="Unit (e.g., mL, km, EUR)" style="max-width:220px">
          <label>Aggregation</label>
          <select id="numAgg">
            <option value="sum">sum</option>
            <option value="avg">avg</option>
            <option value="min">min</option>
            <option value="max">max</option>
            <option value="last">last</option>
          </select>
          <label><input id="numAllowMulti" type="checkbox"> Allow multiple entries per day</label>
          <input id="numDailyGoal" type="number" step="0.01" placeholder="Daily goal (optional)" style="max-width:220px">
        </div>
      </div>
      <label>Color</label>
      <input id="habitColor" type="color" value="#6366f1">
      <label>Monthly goal (times/month)</label>
      <input id="habitMonthlyGoal" type="number" min="0" placeholder="e.g., 10">
      <label>Tags (comma separated)</label>
      <input id="habitTags" type="text" placeholder="e.g., health, cardio">
      <div class="row" style="justify-content:flex-end">
        <button class="btn" onclick="closeAddModal()">Cancel</button>
        <button class="btn primary" onclick="addHabit()">Save</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="metricsModal" onclick="closeMetrics()">
    <div class="modal" onclick="event.stopPropagation()">
      <h3 id="metricsTitle">Enter values</h3>

      <div id="metricsFields">
        <label>Time (min)</label>
        <input id="metricTime" type="number" step="1">
        <label>Distance (km)</label>
        <input id="metricDistance" type="number" step="0.01">
      </div>

      <div id="numericFields" style="display:none">
        <label id="numericLabel">Value</label>
        <input id="numericValue" type="number" step="0.01">
      </div>

      <div class="row" style="justify-content:flex-end">
        <button class="btn" onclick="closeMetrics()">Cancel</button>
        <button class="btn primary" onclick="saveMetrics()">Save</button>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}
